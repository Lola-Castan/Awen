<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
        
        {% block stylesheets %}
            <!-- CDN essentiels -->
            <script src="https://cdn.tailwindcss.com"></script>
            <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
            <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
            <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/fr.js"></script>
            <!-- Configuration de base pour Tailwind --><script>
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                primary: '#4F46E5',
                                secondary: '#10B981'
                            },
                            animation: {
                                'gradient': 'gradient 8s linear infinite'
                            },
                            keyframes: {
                                gradient: {
                                    '0%, 100%': {
                                        'background-size': '200% 200%',
                                        'background-position': 'left center'
                                    },
                                    '50%': {
                                        'background-size': '200% 200%',
                                        'background-position': 'right center'
                                    }
                                }
                            }
                        }
                    }
                };
            </script>
            <!-- Styles personnalisés supplémentaires -->
            <style type="text/tailwindcss">
                @layer components {
                    .btn-primary {
                        @apply bg-primary text-white py-2 px-4 rounded hover:bg-opacity-90;
                    }
                    .card {
                        @apply bg-white rounded shadow p-4;
                    }
                }
            </style>
        {% endblock %}
        {% block javascripts %}
            <!-- jQuery (nécessaire pour Select2) -->
            <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
            <!-- Select2 JS -->
            <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
            {% block importmap %}{{ importmap('app', { defer: false }) }}{% endblock %}
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Menu utilisateur (desktop)
                    const userMenuButton = document.getElementById('user-menu-button');
                    const userDropdown = document.getElementById('user-dropdown');
                    
                    if (userMenuButton && userDropdown) {
                        let isDropdownOpen = false;

                        userMenuButton.addEventListener('click', function() {
                            isDropdownOpen = !isDropdownOpen;
                            userDropdown.classList.toggle('hidden');

                            // Animation du menu
                            if (isDropdownOpen) {
                                userDropdown.style.opacity = '0';
                                userDropdown.style.transform = 'scale(0.95)';
                                userDropdown.classList.remove('hidden');
                                
                                // Force a reflow
                                userDropdown.offsetHeight;
                                
                                userDropdown.style.transition = 'opacity 100ms ease-out, transform 100ms ease-out';
                                userDropdown.style.opacity = '1';
                                userDropdown.style.transform = 'scale(1)';
                            }
                        });

                        // Fermer le menu quand on clique ailleurs
                        document.addEventListener('click', function(e) {
                            if (!userMenuButton.contains(e.target) && !userDropdown.contains(e.target)) {
                                userDropdown.classList.add('hidden');
                                isDropdownOpen = false;
                            }
                        });
                    }

                    // Menu mobile
                    const mobileMenuButton = document.getElementById('mobile-menu-button');
                    const mobileMenu = document.getElementById('mobile-menu');
                    
                    if (mobileMenuButton && mobileMenu) {
                        mobileMenuButton.addEventListener('click', function() {
                            mobileMenu.classList.toggle('hidden');
                        });
                    }
                });
            </script>
        {% endblock %}
    </head>
    <body class="bg-gray-50 flex flex-col min-h-screen">
        <!-- Navbar -->
        <nav class="bg-white shadow-md">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center h-16">
                    <!-- Logo -->
                    <a href="{{ path('home') }}" class="flex items-center space-x-3">
                        <span class="font-bold text-2xl text-primary">Awen</span>
                    </a>
                    
                    <!-- Desktop Navigation -->
                    <div class="hidden md:flex space-x-8">
                        <a href="{{ path('home') }}" class="text-gray-700 hover:text-primary transition-colors">Accueil</a>
                        <a href="{{ path('creators') }}" class="text-gray-700 hover:text-primary transition-colors">Créateurs</a>
                        <a href="{{ path('products') }}" class="text-gray-700 hover:text-primary transition-colors">Produits</a>
                        <a href="{{ path('app_event_index') }}" class="text-gray-700 hover:text-primary transition-colors">Événements</a>
                        <a href="{{ path('post_index') }}" class="text-gray-700 hover:text-primary transition-colors">Posts</a>
                        <a href="#" class="text-gray-700 hover:text-primary transition-colors">À propos</a>
                    </div>
                    
                    <!-- User Menu & Mobile Menu Button -->
                    <div class="flex items-center space-x-4">
                        <!-- User Menu -->
                        <div class="hidden md:flex items-center space-x-4">                            {% if app.user %}
                                <div class="relative">
                                    <button id="user-menu-button" type="button" class="flex items-center text-gray-700 hover:text-primary focus:outline-none">
                                        <span class="mr-2">{{ app.user.firstName }}</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </button>
                                    <div id="user-dropdown" class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg py-2 z-10 hidden divide-y divide-gray-100">
                                        <div class="px-4 py-3">
                                            <p class="text-sm text-gray-900">{{ app.user.firstName }} {{ app.user.lastName }}</p>
                                            <p class="text-sm text-gray-500">{{ app.user.email }}</p>
                                        </div>
                                        
                                        <div class="py-1">                                            <a href="{% if app.user.isCreator %}{{ path('creator_show', {id: app.user.id}) }}{% else %}{{ path('profile_show', {username: app.user.userIdentifier}) }}{% endif %}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                                <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                                </svg>
                                                Mon profil
                                            </a>
                                            <a href="{{ path('account_settings') }}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                                <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                </svg>
                                                Paramètres
                                            </a>
                                        </div>                                        {% if not app.user.isCreator %}
                                            <div class="py-1">
                                                <a href="{{ path('app_become_creator') }}" class="flex items-center px-4 py-2 text-sm font-medium text-indigo-600 hover:bg-indigo-50">
                                                    <svg class="mr-3 h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
                                                    </svg>
                                                    Devenir créateur
                                                </a>
                                            </div>
                                        {% else %}                                            <div class="py-1">
                                                <a href="{{ path('creator_show', {id: app.user.id}) }}" class="flex px-4 py-2 text-sm hover:bg-gray-50 group">
                                                    <div class="relative flex-shrink-0">
                                                        {% if app.user.creatorInfo.coverImage %}
                                                            <img src="{{ asset('uploads/images/' ~ app.user.creatorInfo.coverImage) }}" 
                                                                alt="Photo de profil" 
                                                                class="w-10 h-10 rounded-lg object-cover">
                                                        {% else %}
                                                            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-medium">
                                                                {{ app.user.creatorInfo.displayName|slice(0, 1)|upper }}
                                                            </div>
                                                        {% endif %}
                                                        <span class="absolute bottom-0 right-0 block h-2.5 w-2.5 rounded-full bg-green-400 ring-2 ring-white"></span>
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-medium text-gray-700 group-hover:text-gray-900">{{ app.user.creatorInfo.displayName }}</p>
                                                        <p class="text-xs font-medium text-indigo-600">Mon profil créateur</p>
                                                    </div>
                                                </a>
                                            </div>
                                        {% endif %}

                                        <div class="py-1">
                                            <a href="{{ path('logout') }}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                                <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                                </svg>
                                                Déconnexion
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <a href="{{ path('login') }}" class="text-gray-700 hover:text-primary transition-colors">Connexion</a>
                                <a href="{{ path('register') }}" class="btn-primary">Inscription</a>
                            {% endif %}
                        </div>
                        
                        <!-- Mobile Menu Button -->
                        <button id="mobile-menu-button" class="md:hidden text-gray-700 hover:text-gray-900 focus:outline-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Menu -->
                <div id="mobile-menu" class="md:hidden hidden pb-4">
                    <a href="{{ path('home') }}" class="block py-2 text-gray-700 hover:text-primary">Accueil</a>
                    <a href="{{ path('creators') }}" class="block py-2 text-gray-700 hover:text-primary">Créateurs</a>
                    <a href="{{ path('products') }}" class="block py-2 text-gray-700 hover:text-primary">Produits</a>
                    <a href="{{ path('app_event_index') }}" class="block py-2 text-gray-700 hover:text-primary">Événements</a>
                    <a href="{{ path('post_index') }}" class="block py-2 text-gray-700 hover:text-primary">Posts</a>
                    <a href="#" class="block py-2 text-gray-700 hover:text-primary">À propos</a>
                    
                    {% if app.user %}
                        <hr class="my-2 border-gray-200">
                        <div class="px-4 py-2">
                            <p class="text-sm font-medium text-gray-900">{{ app.user.firstName }} {{ app.user.lastName }}</p>
                            <p class="text-sm text-gray-500">{{ app.user.email }}</p>
                        </div>
                        <a href="{{ path('profile_show', {username: app.user.userIdentifier}) }}" class="flex items-center px-4 py-2 text-gray-700 hover:text-primary">
                            <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            Mon profil
                        </a>
                        <a href="{{ path('account_settings') }}" class="flex items-center px-4 py-2 text-gray-700 hover:text-primary">
                            <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            Paramètres
                        </a>

                        {% if not app.user.isCreator %}
                            <hr class="my-2 border-gray-200">
                            <a href="{{ path('app_become_creator') }}" class="flex items-center px-4 py-2 text-indigo-600 hover:text-indigo-800">
                                <svg class="mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
                                </svg>
                                Devenir créateur
                            </a>
                        {% else %}
                            <hr class="my-2 border-gray-200">
                            <span class="flex items-center px-4 py-2 text-sm text-gray-500">
                                <svg class="mr-3 h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                                </svg>
                                Statut Créateur
                            </span>
                        {% endif %}

                        <hr class="my-2 border-gray-200">
                        <a href="{{ path('logout') }}" class="flex items-center px-4 py-2 text-gray-700 hover:text-primary">
                            <svg class="mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                            Déconnexion
                        </a>
                    {% else %}
                        <hr class="my-2 border-gray-200">
                        <a href="{{ path('login') }}" class="block px-4 py-2 text-gray-700 hover:text-primary">
                            <svg class="inline-block mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                            </svg>
                            Connexion
                        </a>
                        <a href="{{ path('register') }}" class="block px-4 py-2 text-gray-700 hover:text-primary">
                            <svg class="inline-block mr-3 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                            </svg>
                            Inscription
                        </a>
                    {% endif %}
                </div>
            </div>
        </nav>
        
        <!-- Messages flash avec style Tailwind -->
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="mx-auto max-w-7xl px-4 mt-4 {% if label == 'success' %}bg-green-100 text-green-800{% elseif label == 'error' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %} p-4 rounded-md">
                    {{ message }}
                </div>
            {% endfor %}
        {% endfor %}
        
        <!-- Contenu principal -->
        <main class="flex-grow">
            {% block body %}{% endblock %}
        </main>
        
        <!-- Footer -->
        <footer class="bg-white mt-12 py-8 border-t border-gray-200">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">À propos</h3>
                        <p class="text-gray-600">Awen est une plateforme dédiée aux créateurs et artisans pour présenter et vendre leurs créations uniques.</p>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Navigation</h3>
                        <ul class="space-y-2">
                            <li><a href="{{ path('home') }}" class="text-gray-600 hover:text-primary">Accueil</a></li>
                            <li><a href="{{ path('creators') }}" class="text-gray-600 hover:text-primary">Créateurs</a></li>
                            <li><a href="{{ path('products') }}" class="text-gray-600 hover:text-primary">Produits</a></li>
                            <li><a href="{{ path('app_event_index') }}" class="text-gray-600 hover:text-primary">Événements</a></li>
                            <li><a href="{{ path('post_index') }}" class="text-gray-600 hover:text-primary">Posts</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary">À propos</a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Informations</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-600 hover:text-primary">Conditions d'utilisation</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary">Politique de confidentialité</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary">Mentions légales</a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Contact</h3>
                        <ul class="space-y-2">
                            <li class="text-gray-600">Email: contact@awen.com</li>
                            <li class="text-gray-600">Téléphone: 01 23 45 67 89</li>
                        </ul>
                    </div>
                </div>
                <div class="border-t border-gray-200 mt-8 pt-8 text-center text-gray-500">
                    <p>&copy; {{ "now"|date('Y') }} Awen. Tous droits réservés.</p>
                </div>
            </div>
        </footer>

        <!-- Scripts Select2 -->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/fr.js"></script>
    </body>
</html>
